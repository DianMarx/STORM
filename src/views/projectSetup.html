<!DOCTYPE html>
<html>

<head lang="en">
    <meta charset="UTF-8">
    <title>STORM Projects</title>

    <link rel="stylesheet" href="style/css.css">
    <link rel="stylesheet" href="APIs/jquery-ui-1.11.4.custom/jquery-ui.min.css">
    <script src="APIs/jquery-ui-1.11.4.custom/external/jquery/jquery.js"></script>
    <script src="APIs/jquery-ui-1.11.4.custom/jquery-ui.min.js"></script>

    <script>

        $(document).ready(function(e) {


            if (sessionStorage.length == 0) // no user logged on.
            {
                alert("Please log in");
                window.location.href = "/";

                $("#errorDialog").html("You are not logged in. <br> Please go back and log in or sign up. ");
                $("#errorDialog").dialog({
                    resizable: false,
                    modal: true,
                    title: "Error",
                    height: 250,
                    width: 400,
                    buttons: {
                        "Ok": function () {
                            $(this).dialog('close');
                             //return to login
                        }
                    }
                });
            }
            else { //user is logged on.

                $('.loader').html('<img src="images/loader.gif"><br/> Loading Projects...');
                var user = JSON.parse(sessionStorage['User']);
                var projectIDs = JSON.stringify(user.projectID);
                $("#user").text("User: " + user.username);

                //send project ids to server and get projects related to a user
                $.ajax({
                    type: "POST",
                    url: '/projectSetup',
                    data: {"ids" : projectIDs},
                    dataType: "json",
                    success: function (dat, testStatus) {

                        var data = JSON.stringify(dat);
                        var displayProjects = "";
                        for(var i = 0; i < dat.length; i++)
                        {
                            //alert(dat[i].projectName);
                            displayProjects += '<a href="#"><p>'+dat[i].projectName+'</p></a>';
                        }
                        $("#Projects").html(displayProjects);
                        //alert(dat[0].projectName);


                    },

                    error: function(e)
                    {
                        console.log(e);
                        alert(e);
                        /*$("#errorDialog").html("An error has occured: <br> Could not connect to database");
                        $("#errorDialog").dialog({
                            resizable: false,
                            modal: true,
                            title: "Error",
                            height: 250,
                            width: 400,
                            buttons: {
                                "Ok": function () {
                                    $(this).dialog('close');
                                    confirmDeleteTeamTable(element);
                                }
                            }

                        });*/
                    }
                });
            }


        });

    </script>
</head>
<body>
<div class="header">
    <h2 class="headerMessages">Manage Projects</h2><br/>
    <h4 id="user"></h4>
    <img id="logo" src="images/Storm.png" alt="STORM Logo" height="80" />

</div>

<div class="main">

    <div class="background">
        <img src="../Images/Storm.png" style="width: 100%;top:auto;">
    </div>
    <div id="Projects" class="loader"></div>
    <div class="aboutWrapper">
        <div class="aboutUsText">

        </div>
    </div>
</div>
<footer class="footer">
    <div class="footerMenu">
        <table id="tableMenu">
            <tr id="tableMenu">
                <th id="tableMenu"><input id="homeButton" type="text" value="Home"
                                          onclick="window.location='/';" /></th>
                <th id="tableMenu"><input id="aboutButton" type="text" value="About"
                                          onclick="window.location='/about';" /></th>
                <th id="tableMenu"><input id="contactButton" type="text" value="Contact Us"
                                          onclick="window.location='/contact';" /></th>
            </tr>
        </table>
    </div>
</footer>





</body>
</html>